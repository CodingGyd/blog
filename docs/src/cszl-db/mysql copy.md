## 一、概述
MySQL 是最流行的关系型数据库管理系统，在 WEB 应用方面 MySQL 可以说是最流行的技术。选择 MySQL 数据库已是既成事实，绝大多数使用 Linux 操作系统的互联网网站都在使用 MySQL 作为其后端的数据库存储方式，从大型的 BAT 门户到电商平台、分类门户等无一例外。


原因可能有以下几点：

- MySQL 性能卓越，服务稳定，很少出现异常宕机的情况。

- MySQL 开放源代码且无版权制约，自主性强，使用成本低。

- MySQL 历史悠久，社区及用户非常活跃，遇到问题，可以寻求帮助。

- MySQL 软件体积小，安装使用简单，并且易于维护，安装及维护成本低。

- MySQL 品牌口碑效应好，使得企业无须考虑即可直接用之。

- LAMP、LNMP、LNMT（tomcat）等流行 Web 架构都含有 MySQL。

- MySQL 支持多种操作系统，提供了多种 API，支持多种开发语言，特别是对流行的 Java、Python、PHP 等语言都有很好的支持。
 

### 1、整体逻辑架构

![逻辑架构](http://cdn.gydblog.com/images/database/mysql/mysql-jiagou-2.png)

**1）客户端**

本层所提供的服务并不是MySQL所独有的技术。它们都是服务于C/S程序或者是这些程序所需要的，例如连接处理，身份验证，安全性等等。

**2）核心服务层**

本层是MySQL的核心部分，也叫做 SQL Layer。
在 MySQL据库系统处理底层数据之前的所有工作都是在这一层完成的，包括权限判断， sql解析，行计划优化， query cache 的处理以及所有内置的函数(如日期,时间,数学运算,加密)等等。各个存储引擎提供的功能都集中在这一层，如存储过程，触发器，视图等。

**3）存储引擎** 

本层也叫做StorEngine Layer ，是底层数据存取操作实现的核心，由多种存储引擎共同组成。

它们负责存储和获取所有存储在MySQL中的数据。就像Linux众多的文件系统 一样，每个存储引擎都有自己的优点和缺陷。核心服务层通过存储引擎API来与它们交互的。这些API隐藏了各个存储引擎不同的地方。对于服务层尽可能的透明。API包含了很多底层的操作，如开始一个事物，或者取出有特定主键的行。存储引擎不能解析SQL，互相之间也不能通信。仅仅是简单的响应核心服务层的请求。

### 2、架构组件划分

![架构组件划分](http://cdn.gydblog.com/images/database/mysql/mysql-jiagou-1.png)

![架构组件划分中文版](http://cdn.gydblog.com/images/database/mysql/mysql-jiagou-3.png)

**1）客户端连接器(Connectors)**

连接器为不同的客户端程序提供与MySQL服务器的连接。 使得我们能够连接和执行来自另一种语言或环境的MySQL语句，包括ODBC，Java（JDBC），Perl，Python，PHP，Ruby和本机C MySQL实例。

连接器实例：
- Connector/C++ ： 提供C++程序驱动支持，C++程序可以连接到MySQL
- Connector/J：提供JAVA程序驱动程序支持，可使用标准Java数据库连接（JDBC）API从Java应用程序连接到MySQL。
- Connector/NET： 提供.NET程序驱动程序支持，可以支持任何.NET语言编写的应用程序连接MySQL数据库。
- Connector/ODBC：为使用开放数据库连接（ODBC）API连接到MySQL提供驱动程序支持。 支持从Windows，Unix和macOS平台进行ODBC连接。
- Connector/Python：提供Python程序驱动程序支持，可使用兼容 Python DB API版本2.0的API从Python应用程序连接到MySQL。不需要其他Python模块或MySQL客户端库。

**2）系统管理和控制工具**

系统管理和控制工具，比如MySQL安装包bin目录下提供的服务管理和工具（mysqld、mysql_safe、mysql.server等）。

**3）连接池**

连接池是一种创建和管理可供任何需要它们的线程使用的连接池的技术。 连接池可以大大提高Java应用程序的性能，同时减少总体资源使用量。

负责监听对 MySQL Server 的各种请求，接收连接请求，转发所有连接请求到线程管理模块。每一个连接上 MySQL Server 的客户端请求都会被分配（或创建）一个连接线程为其单独服务。而连接线程的主要工作就是负责 MySQL Server 与客户端的通信，接受客户端的命令请求，传递 Server 端的结果信息等。线程管理模块则负责管理维护这些连接线程。包括线程的创建，线程的 cache 等。
 
**4）SQL 接口**

SQL Interface（SQL接口组件），接受用户的SQL命令，并且返回用户需要查询的结果。比如select from就是调用SQL Interface

**5）解析器**  

SQL命令传递到解析器的时候会被解析器验证和解析。解析器是由Lex和YACC实现的，是一个很长的脚本。

在 MySQL中我们习惯将所有 Client 端发送给 Server 端的命令都称为 query ，在 MySQL Server 里面，连接线程接收到客户端的一个 Query 后，会直接将该 query 传递给专门负责将各种 Query 进行分类然后转发给各个对应的处理模块。

主要功能：
- 将SQL语句进行语义和语法的分析，分解成数据结构，然后按照不同的操作类型进行分类，然后做出针对性的转发到后续步骤，以后SQL语句的传递和处理就是基于这个结构的。
- 如果在分解构成中遇到错误，那么就说明这个sql语句是不合理的

**6）查询优化器** 

SQL语句在查询之前会使用查询优化器对查询进行优化。就是优化客户端请求的 query（sql语句） ，根据客户端请求的 query 语句，和数据库中的一些统计信息，在一系列算法的基础上进行分析，得出一个最优的策略，告诉后面的程序如何取得这个 query 语句的结果
 
**7）缓存**

主要功能是将客户端提交 给MySQL 的 Select 类 query 请求的返回结果集 cache 到内存中，与该 query 的一个 hash 值 做一个对应。该 Query 所取数据的基表发生任何数据的变化之后， MySQL 会自动使该 query 的Cache 失效。在读写比例非常高的应用系统中， Query Cache 对性能的提高是非常显著的。当然它对内存的消耗也是非常大的。

如果查询缓存有命中的查询结果，查询语句就可以直接去查询缓存中取数据。这个缓存机制是由一系列小缓存组成的。比如表缓存，记录缓存，key缓存，权限缓存等

**8）可插拔存储引擎**

存储引擎接口模块可以说是 MySQL 数据库中最有特色的一点了。目前各种数据库产品中，基本上只有 MySQL 可以实现其底层数据存储引擎的插件式管理。这个模块实际上只是 一个抽象类，但正是因为它成功地将各种数据处理高度抽象化，才成就了今天 MySQL 可插拔存储引擎的特色。

从图可以看出，MySQL区别于其他数据库的最重要的特点就是其插件式的表存储引擎。MySQL插件式的存储引擎架构提供了一系列标准的管理和服务支持，这些标准与存储引擎本身无关，可能是每个数据库系统本身都必需的，如SQL分析器和优化器等，而存储引擎是底层物理结构的实现，每个存储引擎开发者都可以按照自己的意愿来进行开发。
  
> 注意：存储引擎是基于表的，而不是数据库。


在MySQL中，存储引擎是以插件的形式运行的。支持的引擎有十几种之多，但我们实战常用到的，大概只有InnoDB、MyISAM 、Memory、Archive 了，下面是这几种引擎的区别：

![存储引擎区别](http://cdn.gydblog.com/images/database/mysql/mysql-jiagou-4.png)


## 三、基础知识-版本定义
MySQL 数据库的官方网站为http://www.mysql.com，其发布的 MySQL 版本采用双授权政策，和大多数开源产品的路线一样，MySQL 数据库也有社区版和企业版之分，且这两个版本又各自分了四个版本依次发布，这四个版本分别为：Alpha 版、Beta 版、RC 版和 GA 版本。

生产环境应该选择GA版本!

![版本路线分类](http://cdn.gydblog.com/images/database/mysql/mysql-version.jpg)
 