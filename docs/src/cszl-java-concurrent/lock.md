---
# icon: lock
date: 2023-06-26

category:
  - Java
tag:
  - 并发编程
  - 锁
---
# 锁的那些事
## 锁的常见分类
<img src="/images/java/concurrent/lock-1.png"  style="zoom: 50%;margin:0 auto;display:block"/><br/>

## 乐观锁和悲观锁

**乐观锁**  
乐观锁是指认为自己在使用数据时不会有别的线程来修改数据，所以不会添加锁。
在JAVA中是通过无锁编程来实现，只是在最后更新数据的时候才去判断之前有没有别的线程更新了这个数据，此时会出现两种判断：
- 如果这个数据没有被别的线程更新，则当前线程将自己修改的数据写入。
- 如果这个数据已经被别的线程更新，则当前线程可以选择放弃修改或者重新获取最新数据进行重新修改。

判断的规则常用如下方式：
- version版本号机制
- cas算法(java中atomic包中的递增操作就算通过CAS自旋实现的)


乐观锁适合读操作多的场景，不加锁能大大提高并发性能。

**悲观锁**

悲观锁认为自己使用数据时肯定会有别的线程也来竞争操作，在使用之前先加锁，确保数据不会被别的线程修改。  

在java中synchronized关键字和lock的api原理都是悲观锁。  

悲观锁适合写操作多的场景，性能相对乐观锁要差。